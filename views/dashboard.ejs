<div class="dashboard-container">
    <div class="dashboard-header">
        <h1>Панель управления</h1>
        <p>Обзор активности и статистика анализа доменов</p>
    </div>
    
    <div class="dashboard-stats">
        <div class="stat-card">
            <div class="stat-value">1,245</div>
            <div class="stat-label">Проанализировано доменов</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">42</div>
            <div class="stat-label">Отчетов создано</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">502</div>
            <div class="stat-label">Рекомендованных доменов</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">85%</div>
            <div class="stat-label">Точность рекомендаций</div>
        </div>
    </div>
    
    <div class="dashboard-row">
        <div class="dashboard-card chart-card">
            <h2>Домены по годам регистрации</h2>
            <div class="chart-container">
                <canvas id="domainsByYearChart"></canvas>
            </div>
        </div>
        <div class="dashboard-card chart-card">
            <h2>Статистика рекомендаций</h2>
            <div class="chart-container">
                <canvas id="recommendationsChart"></canvas>
            </div>
        </div>
    </div>
    
    <div class="dashboard-row">
        <div class="dashboard-card chart-card">
            <h2>Распределение времени анализа</h2>
            <div class="chart-container">
                <canvas id="analysisTimeChart"></canvas>
            </div>
        </div>
        <div class="dashboard-card">
            <h2>Последние отчеты</h2>
            <div class="table-responsive">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Название</th>
                            <th>Дата</th>
                            <th>Доменов</th>
                            <th>Рекомендовано</th>
                            <th>Статус</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Анализ дропов от 20.05.2025</td>
                            <td>20.05.2025 14:30</td>
                            <td>1000</td>
                            <td>342</td>
                            <td><span class="badge badge-success">Завершен</span></td>
                            <td><a href="/reports/report-001" class="btn btn-sm btn-outline">Просмотр</a></td>
                        </tr>
                        <tr>
                            <td>Долгоживущие домены</td>
                            <td>18.05.2025 10:15</td>
                            <td>500</td>
                            <td>125</td>
                            <td><span class="badge badge-success">Завершен</span></td>
                            <td><a href="/reports/report-002" class="btn btn-sm btn-outline">Просмотр</a></td>
                        </tr>
                        <tr>
                            <td>Тестовый анализ</td>
                            <td>15.05.2025 09:45</td>
                            <td>100</td>
                            <td>35</td>
                            <td><span class="badge badge-success">Завершен</span></td>
                            <td><a href="/reports/report-003" class="btn btn-sm btn-outline">Просмотр</a></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<% const extraScripts = ['/js/components/charts.js']; %>

<script>
    // Инициализация графиков при загрузке страницы
    document.addEventListener('DOMContentLoaded', function() {
        // Получение данных для графиков
        fetch('/dashboard/chart-data')
            .then(response => response.json())
            .then(data => {
                // График доменов по годам
                const domainsByYearCtx = document.getElementById('domainsByYearChart').getContext('2d');
                new Chart(domainsByYearCtx, {
                    type: 'bar',
                    data: data.domainsByYear,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
                
                // График статистики рекомендаций
                const recommendationsCtx = document.getElementById('recommendationsChart').getContext('2d');
                new Chart(recommendationsCtx, {
                    type: 'doughnut',
                    data: data.recommendationStats,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                            }
                        }
                    }
                });
                
                // График распределения времени анализа
                const analysisTimeCtx = document.getElementById('analysisTimeChart').getContext('2d');
                new Chart(analysisTimeCtx, {
                    type: 'bar',
                    data: data.analysisTimeDistribution,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            })
            .catch(error => console.error('Ошибка при загрузке данных для графиков:', error));
    });
</script>
